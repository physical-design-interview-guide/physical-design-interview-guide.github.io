{{/* 
  Usage in posts:
  {{< img src="/img/posts/my-image.jpg" alt="Description" caption="Optional caption" >}}
  
  Automatically serves WebP if available, falls back to original.
  Lazy loads by default. Max width 100%.
*/}}
{{ $src := .Get "src" }}
{{ $alt := .Get "alt" | default "" }}
{{ $caption := .Get "caption" | default "" }}

{{/* Build WebP path by replacing extension */}}
{{ $webp := replaceRE `\.(jpg|jpeg|png|JPG|JPEG|PNG)$` ".webp" $src }}

<figure class="post-image">
  <picture>
    <source srcset="{{ $webp }}" type="image/webp"/>
    <img src="{{ $src }}"
         alt="{{ $alt }}"
         loading="lazy"
         decoding="async"
         style="max-width:100%; height:auto; border-radius:4px;"/>
  </picture>
  {{ if $caption }}<figcaption>{{ $caption }}</figcaption>{{ end }}
</figure>
